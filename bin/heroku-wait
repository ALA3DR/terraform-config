#!/usr/bin/env bash

set -o errexit

main() {
  if [[ $# -ne 1 ]]; then
    echo "Usage: $(basename "${0}") <heroku-app>" >&2
    exit 1
  fi

  local heroku_app="${1}"
  local timeout="${2:-120}"
  local c=0

  while ! curl \
    -f -s -n "https://api.heroku.com/apps/${heroku_app}" \
    -H "Accept: application/vnd.heroku+json; version=3" \
    -H "Authorization: Bearer ${HEROKU_API_KEY}"; do
    let c+=10
    if [[ $c -gt ${timeout} ]]; then
      exit 1
    fi
    sleep 10
  done
}

main "${@}"

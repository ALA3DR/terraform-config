#!/usr/bin/env bash

set -o errexit

main() {
  cat <<EOF
# WARNING: this file is generated!

resource "aws_route_table" "public" {
  vpc_id = "\${aws_vpc.main.id}"

EOF

  for ip in $(dig +short -t A -4 quay.io | sort); do
    cat <<EOF
  route {
    cidr_block = "${ip}/32"
    instance_id = "\${aws_instance.nat_quay.id}"
  }

EOF
  done

  cat <<EOF
  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = "\${aws_internet_gateway.gw.id}"
  }
}
EOF
}

main "$@"
